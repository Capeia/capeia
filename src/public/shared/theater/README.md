# Theater
The `Theater` module is used for displaying large interface elements such as
section images. Using `react-side-effect`, the theater contents
can be changed dynamically from anywhere within the React render tree.

## Usage
* Render `<Theater />` and one or more `<TheaterContent>` components. Note that
the former may contain additional children that will be rendered before the
contents of `<TheaterContent>`. The "innermost" `<TheaterContent>` determines
the rendered contents.
* During SSR, use `renderTheaterIntoMarkup` to render the theater contents into
the markup generated by `ReactDOMServer.renderToString()`.
* Send the returned `rendered` content markup as `window.__theaterInitialContent`
to the client in order to enable the initial re-render (avoiding checksum errors).

## Implementation
The goal of this module is to provide the means to change `<Theater />`
contents from anywhere within the React render tree, at any point.

This proves difficult to achieve during SSR, as `<Theater />` is inherently
stateful, and re-renders cannot be triggered with `Component.setState()`.

The workaround here is to instead render in two passes:
* During the first render pass, the entire document is rendered as usual,
including the `<Theater />` and arbitrarily many `<TheaterContent>` components.
Instead of rendering the contents into `<Theater />` however, a per-request
unique id is rendered (e.g. `__theater:d62a1598-4b68-43ed-90f2-36f1a96ca1c7`).
* During the second render pass (within `renderTheaterIntoMarkup`), the unique
id is replaced by the actual markup and Reacts checksum is updated to reflect
the changes within the tree. Note that the contents are rendered using
`renderToStaticMarkup`, which means that they cannot be reconciled on the client.

## Limitations
* As the content is rendered as a separate React tree, context cannot be
accessed from components nested inside `<TheaterContent>` during SSR.
* The current implementation expects `<Theater />` to be rendered only once
(or not at all) per request.
